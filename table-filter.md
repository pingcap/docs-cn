---
title: è¡¨åº“è¿‡æ»¤
summary: åœ¨ TiDB ç”Ÿæ€å·¥å…·ä¸­ä½¿ç”¨è¡¨åº“è¿‡æ»¤åŠŸèƒ½ã€‚
aliases: ['/docs-cn/dev/table-filter/','/docs-cn/dev/tidb-lightning/tidb-lightning-table-filter/','/docs-cn/dev/reference/tools/tidb-lightning/table-filter/','/zh/tidb/dev/tidb-lightning-table-filter/']
---

# è¡¨åº“è¿‡æ»¤

TiDB ç”Ÿæ€å·¥å…·é»˜è®¤æƒ…å†µä¸‹ä½œç”¨äºæ‰€æœ‰æ•°æ®åº“ï¼Œä½†å®é™…ä½¿ç”¨ä¸­ï¼Œå¾€å¾€åªéœ€è¦ä½œç”¨äºå…¶ä¸­çš„éƒ¨åˆ†å­é›†ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åªæƒ³å¤„ç† `foo*` å’Œ `bar*` å½¢å¼çš„è¡¨ï¼Œè€Œæ— éœ€å¯¹å…¶ä»–è¡¨è¿›è¡Œæ“ä½œã€‚

ä» TiDB 4.0 èµ·ï¼Œæ‰€æœ‰ TiDB ç”Ÿæ€ç³»ç»Ÿå·¥å…·éƒ½ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„è¿‡æ»¤è¯­æ³•æ¥å®šä¹‰å­é›†ã€‚æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨è¡¨åº“è¿‡æ»¤åŠŸèƒ½ã€‚

## ä½¿ç”¨è¡¨åº“è¿‡æ»¤

### å‘½ä»¤è¡Œ

åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨å¤šä¸ª `-f` æˆ– `--filter` å‚æ•°ï¼Œå³å¯åœ¨ TiDB ç”Ÿæ€å·¥å…·ä¸­åº”ç”¨è¡¨åº“è¿‡æ»¤è§„åˆ™ã€‚æ¯ä¸ªè¿‡æ»¤è§„åˆ™å‡é‡‡ç”¨ `db.table` å½¢å¼ï¼Œæ”¯æŒé€šé…ç¬¦ï¼ˆè¯¦æƒ…è§[ä¸‹ä¸€èŠ‚](#ä½¿ç”¨é€šé…ç¬¦)ï¼‰ã€‚ä»¥ä¸‹ä¸ºå„ä¸ªå·¥å…·ä¸­çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

* [BR](/br/backup-and-restore-tool.md)ï¼š

    {{< copyable "shell-regular" >}}

    ```shell
    ./br backup full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    #                ^~~~~~~~~~~~~~~~~~~~~~~
    ./br restore full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    #                 ^~~~~~~~~~~~~~~~~~~~~~~
    ```

* [Dumpling](/backup-and-restore-using-dumpling-lightning.md)ï¼š

    {{< copyable "shell-regular" >}}

    ```shell
    ./dumpling -f 'foo*.*' -f 'bar*.*' -P 3306 -o /tmp/data/
    #          ^~~~~~~~~~~~~~~~~~~~~~~
    ```

* [TiDB Lightning](/tidb-lightning/tidb-lightning-overview.md)ï¼š

    {{< copyable "shell-regular" >}}

    ```shell
    ./tidb-lightning -f 'foo*.*' -f 'bar*.*' -d /tmp/data/ --backend tidb
    #                ^~~~~~~~~~~~~~~~~~~~~~~
    ```

### TOML é…ç½®æ–‡ä»¶

åœ¨ TOML æ–‡ä»¶ä¸­ï¼Œè¡¨åº“è¿‡æ»¤è§„åˆ™ä»¥[å­—ç¬¦ä¸²æ•°ç»„](https://toml.io/cn/v1.0.0-rc.1#%E6%95%B0%E7%BB%84)çš„å½¢å¼æŒ‡å®šã€‚ä»¥ä¸‹ä¸ºå„ä¸ªå·¥å…·ä¸­çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

* TiDB Lightningï¼š

    ```toml
    [mydumper]
    filter = ['foo*.*', 'bar*.*']
    ```

* [TiCDC](/ticdc/ticdc-overview.md)ï¼š

    ```toml
    [filter]
    rules = ['foo*.*', 'bar*.*']

    [[sink.dispatchers]]
    matcher = ['db1.*', 'db2.*', 'db3.*']
    dispatcher = 'ts'
    ```

## è¡¨åº“è¿‡æ»¤è¯­æ³•

### ç›´æ¥ä½¿ç”¨è¡¨å

æ¯æ¡è¡¨åº“è¿‡æ»¤è§„åˆ™ç”±â€œåº“â€å’Œâ€œè¡¨â€ç»„æˆï¼Œä¸¤éƒ¨åˆ†ä¹‹é—´ä»¥è‹±æ–‡å¥å· (`.`) åˆ†éš”ã€‚åªæœ‰è¡¨åä¸è§„åˆ™å®Œå…¨ç›¸ç¬¦çš„è¡¨æ‰ä¼šè¢«æ¥å—ã€‚

```
db1.tbl1
db2.tbl2
db3.tbl3
```

è¡¨ååªç”±æœ‰æ•ˆçš„[æ ‡è¯†ç¬¦](/schema-object-names.md)ç»„æˆï¼Œä¾‹å¦‚ï¼š

* æ•°å­—ï¼ˆ`0` åˆ° `9`ï¼‰
* å­—æ¯ï¼ˆ`a` åˆ° `z`ï¼Œ`A` åˆ° `Z`ï¼‰
* `$`
* `_`
* é ASCII å­—ç¬¦ï¼ˆ`U+0080` åˆ° `U+10FFFF`ï¼‰

å…¶ä»– ASCII å­—ç¬¦å‡ä¸ºä¿ç•™å­—ã€‚éƒ¨åˆ†æ ‡ç‚¹ç¬¦å·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¯¦æƒ…è§ä¸‹ä¸€èŠ‚ã€‚

### ä½¿ç”¨é€šé…ç¬¦

è¡¨åçš„ä¸¤ä¸ªéƒ¨åˆ†å‡æ”¯æŒä½¿ç”¨é€šé…ç¬¦ï¼ˆè¯¦æƒ…è§ [fnmatch(3)](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_13)ï¼‰ã€‚

* `*`ï¼šåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚
* `?`ï¼šåŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚
* `[a-z]`ï¼šåŒ¹é… â€œaâ€ å’Œ â€œzâ€ ä¹‹é—´çš„ä¸€ä¸ªå­—ç¬¦ã€‚
* `[!a-z]`ï¼šåŒ¹é…ä¸åœ¨ â€œaâ€ å’Œ â€œzâ€ ä¹‹é—´çš„ä¸€ä¸ªå­—ç¬¦ã€‚

```
db[0-9].tbl[0-9a-f][0-9a-f]
data.*
*.backup_*
```

æ­¤å¤„ï¼Œâ€œå­—ç¬¦â€æŒ‡çš„æ˜¯ä¸€ä¸ª Unicode ç ä½ï¼Œä¾‹å¦‚ï¼š

* `U+00E9` "Ã©" æ˜¯ 1 ä¸ªå­—ç¬¦ã€‚
* `U+0065ï¼ŒU+0301` "eÌ" æ˜¯ 2 ä¸ªå­—ç¬¦ã€‚
* `U+1F926 U+1F3FF U+200D U+2640 U+FE0F` "ğŸ¤¦ğŸ¿â€â™€ï¸" æ˜¯ 5 ä¸ªå­—ç¬¦ã€‚

### ä½¿ç”¨æ–‡ä»¶å¯¼å…¥

å¦‚éœ€å¯¼å…¥ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºè¿‡æ»¤è§„åˆ™ï¼Œè¯·åœ¨è§„åˆ™çš„å¼€å¤´åŠ ä¸Šä¸€ä¸ª â€œ@â€ æ¥æŒ‡å®šæ–‡ä»¶åã€‚åº“è¡¨è¿‡æ»¤è§£æå™¨å°†å¯¼å…¥æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œéƒ½è§£æä¸ºä¸€æ¡é¢å¤–çš„è¿‡æ»¤è§„åˆ™ã€‚

ä¾‹å¦‚ï¼Œ`config/filter.txt` æ–‡ä»¶æœ‰ä»¥ä¸‹å†…å®¹ï¼š

```
employees.*
*.WorkOrder
```

ä»¥ä¸‹ä¸¤æ¡è¡¨åº“è¿‡æ»¤å‘½ä»¤æ˜¯ç­‰ä»·çš„ï¼š

```bash
./dumpling -f '@config/filter.txt'
./dumpling -f 'employees.*' -f '*.WorkOrder'
```

å¯¼å…¥çš„æ–‡ä»¶é‡Œä¸èƒ½ä½¿ç”¨è¿‡æ»¤è§„åˆ™å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚

### æ³¨é‡Šä¸ç©ºè¡Œ

å¯¼å…¥çš„è¿‡æ»¤è§„åˆ™æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€è¡Œå¼€å¤´å’Œç»“å°¾çš„ç©ºæ ¼éƒ½ä¼šè¢«å»é™¤ã€‚æ­¤å¤–ï¼Œç©ºè¡Œï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ä¹Ÿå°†è¢«å¿½ç•¥ã€‚

è¡Œé¦–çš„ `#` è¡¨ç¤ºè¯¥è¡Œæ˜¯æ³¨é‡Šï¼Œä¼šè¢«å¿½ç•¥ã€‚è€Œä¸åœ¨è¡Œé¦–çš„ `#` åˆ™ä¼šè¢«è®¤ä¸ºæ˜¯è¯­æ³•é”™è¯¯ã€‚

```
# è¿™æ˜¯ä¸€è¡Œæ³¨é‡Š
db.table   # è¿™ä¸€éƒ¨åˆ†ä¸æ˜¯æ³¨é‡Šï¼Œä¸”å¯èƒ½å¼•èµ·é”™è¯¯
```

### æ’é™¤è§„åˆ™

åœ¨ä¸€æ¡è¿‡æ»¤è§„åˆ™çš„å¼€å¤´åŠ ä¸Š `!`ï¼Œåˆ™è¡¨ç¤ºç¬¦åˆè¿™æ¡è§„åˆ™çš„è¡¨ä¸ä¼šè¢« TiDB ç”Ÿæ€å·¥å…·å¤„ç†ã€‚é€šè¿‡åº”ç”¨æ’é™¤è§„åˆ™ï¼Œåº“è¡¨è¿‡æ»¤å¯ä»¥ä½œä¸ºå±è”½åå•æ¥ä½¿ç”¨ã€‚

```
*.*
#^ æ³¨æ„ï¼šå¿…é¡»å…ˆæ·»åŠ  *.* è§„åˆ™æ¥åŒ…æ‹¬æ‰€æœ‰è¡¨
!*.Password
!employees.salaries
```

### è½¬ä¹‰å­—ç¬¦

å¦‚æœéœ€è¦å°†ç‰¹æ®Šå­—ç¬¦è½¬åŒ–ä¸ºæ ‡è¯†ç¬¦ï¼Œå¯ä»¥åœ¨ç‰¹æ®Šå­—ç¬¦å‰åŠ ä¸Šåæ–œæ  `\`ã€‚

```
db\.with\.dots.*
```

ä¸ºäº†ç®€åŒ–è¯­æ³•å¹¶å‘ä¸Šå…¼å®¹ï¼Œ**ä¸æ”¯æŒ**ä¸‹åˆ—å­—ç¬¦åºåˆ—ï¼š

- åœ¨è¡Œå°¾å»é™¤ç©ºæ ¼åä½¿ç”¨ `\`ï¼ˆä½¿ç”¨ `[ ]` æ¥åŒ¹é…è¡Œå°¾çš„ç©ºæ ¼ï¼‰ã€‚
- åœ¨ `\` åä½¿ç”¨æ•°å­—æˆ–å­—æ¯ (`[0-9a-zA-Z]`)ã€‚ç‰¹åˆ«æ˜¯ç±»ä¼¼ C çš„è½¬ä¹‰åºåˆ—ï¼Œå¦‚ `\0`ã€`\r`ã€`\n`ã€`\t` ç­‰åºåˆ—ï¼Œç›®å‰åœ¨è¡¨åº“è¿‡æ»¤è§„åˆ™ä¸­æ— æ„ä¹‰ã€‚

### å¼•å·åŒ…è£¹çš„æ ‡è¯†ç¬¦

é™¤äº† `\` ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨ `"` å’Œ `` ` `` æ¥æ§åˆ¶ç‰¹æ®Šå­—ç¬¦ã€‚

```
"db.with.dots"."tbl\1"
`db.with.dots`.`tbl\2`
```

ä¹Ÿå¯ä»¥é€šè¿‡è¾“å…¥ä¸¤æ¬¡å¼•å·ï¼Œå°†å¼•å·åŒ…å«åœ¨æ ‡è¯†ç¬¦å†…ã€‚

```
"foo""bar".`foo``bar`
# ç­‰ä»·äºï¼š
foo\"bar.foo\`bar
```

ç”¨å¼•å·åŒ…è£¹çš„æ ‡è¯†ç¬¦ä¸å¯ä»¥è·¨è¶Šå¤šè¡Œã€‚

ç”¨å¼•å·åªåŒ…è£¹æ ‡è¯†ç¬¦çš„ä¸€éƒ¨åˆ†æ˜¯æ— æ•ˆçš„ï¼Œä¾‹å¦‚ï¼š

```
"this is "invalid*.*
```

### æ­£åˆ™è¡¨è¾¾å¼

å¦‚æœä½ éœ€è¦ä½¿ç”¨è¾ƒå¤æ‚çš„è¿‡æ»¤è§„åˆ™ï¼Œå¯ä»¥å°†æ¯ä¸ªåŒ¹é…æ¨¡å‹å†™ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥ `/` ä¸ºåˆ†éš”ç¬¦ï¼š

```
/^db\d{2,}$/./^tbl\d{2,}$/
```

è¿™ç±»æ­£åˆ™è¡¨ç¤ºä½¿ç”¨ [Go dialect](https://pkg.go.dev/regexp/syntax?tab=doc)ã€‚åªè¦æ ‡è¯†ç¬¦ä¸­æœ‰ä¸€ä¸ªå­å­—ç¬¦ä¸²ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œåˆ™è§†ä¸ºåŒ¹é…è¯¥æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œ`/b/` åŒ¹é… `db01`ã€‚

> **æ³¨æ„ï¼š**
>
> æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ¯ä¸€ä¸ª `/` éƒ½éœ€è¦è½¬ä¹‰ä¸º `\/`ï¼ŒåŒ…æ‹¬åœ¨ `[...]` é‡Œé¢çš„ `/`ã€‚ä¸å…è®¸åœ¨ `\Q...\E` ä¹‹é—´æ”¾ç½®ä¸€ä¸ªæœªè½¬ä¹‰çš„ `/`ã€‚

## ä½¿ç”¨å¤šä¸ªè¿‡æ»¤è§„åˆ™

å½“è¡¨çš„åç§°ä¸è¿‡æ»¤åˆ—è¡¨ä¸­æ‰€æœ‰è§„åˆ™å‡ä¸åŒ¹é…æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™äº›è¡¨è¢«å¿½ç•¥ã€‚

è¦å»ºç«‹ä¸€ä¸ªå±è”½åå•ï¼Œå¿…é¡»ä½¿ç”¨æ˜¾å¼çš„ `*.*` ä½œä¸ºç¬¬ä¸€æ¡è¿‡æ»¤è§„åˆ™ï¼Œå¦åˆ™æ‰€æœ‰è¡¨å‡è¢«æ’é™¤ã€‚

```bash
# æ‰€æœ‰è¡¨å‡è¢«è¿‡æ»¤æ‰
./dumpling -f '!*.Password'

# åªæœ‰ â€œPasswordâ€ è¡¨è¢«è¿‡æ»¤æ‰ï¼Œå…¶ä½™è¡¨ä»ä¿ç•™
./dumpling -f '*.*' -f '!*.Password'
```

å¦‚æœä¸€ä¸ªè¡¨çš„åç§°ä¸è¿‡æ»¤åˆ—è¡¨ä¸­çš„å¤šä¸ªè§„åˆ™åŒ¹é…ï¼Œåˆ™ä»¥æœ€ååŒ¹é…çš„è§„åˆ™ä¸ºå‡†ã€‚ä¾‹å¦‚ï¼š

```
# rule 1
employees.*
# rule 2
!*.dep*
# rule 3
*.departments
```

è¿‡æ»¤ç»“æœå¦‚ä¸‹ï¼š

| è¡¨å            | è§„åˆ™ 1 | è§„åˆ™ 2 | è§„åˆ™ 3 | ç»“æœ          |
|-----------------------|--------|--------|--------|------------------|
| irrelevant.table      |        |        |        | é»˜è®¤ï¼ˆæ‹’ç»ï¼‰ |
| employees.employees   | âœ“      |        |        | è§„åˆ™ 1ï¼ˆæ¥å—ï¼‰  |
| employees.dept_emp    | âœ“      | âœ“      |        | è§„åˆ™ 2ï¼ˆæ‹’ç»ï¼‰  |
| employees.departments | âœ“      | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰  |
| else.departments      |        | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰  |

> **æ³¨æ„ï¼š**
>
> åœ¨ TiDB ç”Ÿæ€å·¥å…·çš„é»˜è®¤é…ç½®ä¸­ï¼Œç³»ç»Ÿåº“æ€»æ˜¯è¢«æ’é™¤ã€‚ç³»ç»Ÿåº“æœ‰ä»¥ä¸‹å…­ä¸ªï¼š
>
> * `INFORMATION_SCHEMA`
> * `PERFORMANCE_SCHEMA`
> * `METRICS_SCHEMA`
> * `INSPECTION_SCHEMA`
> * `mysql`
> * `sys`
