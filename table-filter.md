---
title: è¡¨è¿‡æ»¤å™¨
summary: TiDB å·¥å…·ä¸­è¡¨è¿‡æ»¤å™¨åŠŸèƒ½çš„ä½¿ç”¨ã€‚
---

# è¡¨è¿‡æ»¤å™¨

TiDB è¿ç§»å·¥å…·é»˜è®¤æ“ä½œæ‰€æœ‰æ•°æ®åº“ï¼Œä½†é€šå¸¸åªéœ€è¦å¤„ç†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½åªæƒ³å¤„ç†å½¢å¦‚ `foo*` å’Œ `bar*` çš„ schemaï¼Œè€Œä¸éœ€è¦å…¶ä»–çš„ã€‚

ä» TiDB 4.0 å¼€å§‹ï¼Œæ‰€æœ‰ TiDB è¿ç§»å·¥å…·å…±äº«ä¸€ä¸ªé€šç”¨çš„è¿‡æ»¤å™¨è¯­æ³•æ¥å®šä¹‰å­é›†ã€‚æœ¬æ–‡æè¿°å¦‚ä½•ä½¿ç”¨è¡¨è¿‡æ»¤å™¨åŠŸèƒ½ã€‚

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œç•Œé¢

å¯ä»¥ä½¿ç”¨å¤šä¸ª `-f` æˆ– `--filter` å‘½ä»¤è¡Œå‚æ•°å¯¹å·¥å…·åº”ç”¨è¡¨è¿‡æ»¤å™¨ã€‚æ¯ä¸ªè¿‡æ»¤å™¨çš„å½¢å¼ä¸º `db.table`ï¼Œå…¶ä¸­æ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥æ˜¯é€šé…ç¬¦ï¼ˆåœ¨[ä¸‹ä¸€èŠ‚](#é€šé…ç¬¦)ä¸­è¿›ä¸€æ­¥è§£é‡Šï¼‰ã€‚ä»¥ä¸‹åˆ—å‡ºäº†ç¤ºä¾‹ç”¨æ³•ã€‚

<CustomContent platform="tidb">

* [BR](/br/backup-and-restore-overview.md)ï¼š

    ```shell
    tiup br backup full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    ```

    ```shell
    tiup br restore full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    ```

</CustomContent>

* [Dumpling](https://docs.pingcap.com/tidb/stable/dumpling-overview)ï¼š

    ```shell
    tiup dumpling -f 'foo*.*' -f 'bar*.*' -P 3306 -o /tmp/data/
    ```

<CustomContent platform="tidb">

* [TiDB Lightning](/tidb-lightning/tidb-lightning-overview.md)ï¼š

    ```shell
    tiup tidb-lightning -f 'foo*.*' -f 'bar*.*' -d /tmp/data/ --backend tidb
    ```

</CustomContent>

<CustomContent platform="tidb-cloud">

* [TiDB Lightning](https://docs.pingcap.com/tidb/stable/tidb-lightning-overview)ï¼š

    ```shell
    tiup tidb-lightning -f 'foo*.*' -f 'bar*.*' -d /tmp/data/ --backend tidb
    ```

</CustomContent>

### TOML é…ç½®æ–‡ä»¶

TOML æ–‡ä»¶ä¸­çš„è¡¨è¿‡æ»¤å™¨è¢«æŒ‡å®šä¸º[å­—ç¬¦ä¸²æ•°ç»„](https://toml.io/en/v1.0.0-rc.1#section-15)ã€‚ä»¥ä¸‹åˆ—å‡ºäº†ç¤ºä¾‹ç”¨æ³•ã€‚

* TiDB Lightningï¼š

    ```toml
    [mydumper]
    filter = ['foo*.*', 'bar*.*']
    ```

<CustomContent platform="tidb">

* [TiCDC](/ticdc/ticdc-overview.md)ï¼š

    ```toml
    [filter]
    rules = ['foo*.*', 'bar*.*']

    [[sink.dispatchers]]
    matcher = ['db1.*', 'db2.*', 'db3.*']
    dispatcher = 'ts'
    ```

</CustomContent>

## è¯­æ³•

### æ™®é€šè¡¨å

æ¯ä¸ªè¡¨è¿‡æ»¤å™¨è§„åˆ™ç”±ä¸€ä¸ª"schema æ¨¡å¼"å’Œä¸€ä¸ª"è¡¨æ¨¡å¼"ç»„æˆï¼Œç”¨ç‚¹å· (`.`) åˆ†éš”ã€‚å®Œå…¨é™å®šåç§°åŒ¹é…è§„åˆ™çš„è¡¨ä¼šè¢«æ¥å—ã€‚

```
db1.tbl1
db2.tbl2
db3.tbl3
```

æ™®é€šåç§°å¿…é¡»åªåŒ…å«æœ‰æ•ˆçš„[æ ‡è¯†ç¬¦å­—ç¬¦](/schema-object-names.md)ï¼Œä¾‹å¦‚ï¼š

* æ•°å­—ï¼ˆ`0` åˆ° `9`ï¼‰
* å­—æ¯ï¼ˆ`a` åˆ° `z`ï¼Œ`A` åˆ° `Z`ï¼‰
* `$`
* `_`
* é ASCII å­—ç¬¦ï¼ˆU+0080 åˆ° U+10FFFFï¼‰

æ‰€æœ‰å…¶ä»– ASCII å­—ç¬¦éƒ½æ˜¯ä¿ç•™çš„ã€‚æŸäº›æ ‡ç‚¹ç¬¦å·å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æè¿°ã€‚

### é€šé…ç¬¦

åç§°çš„æ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥æ˜¯ [fnmatch(3)](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_13) ä¸­æè¿°çš„é€šé…ç¬¦ç¬¦å·ï¼š

* `*` â€” åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦
* `?` â€” åŒ¹é…ä¸€ä¸ªå­—ç¬¦
* `[a-z]` â€” åŒ¹é…ä¸€ä¸ªåœ¨ "a" åˆ° "z" èŒƒå›´å†…çš„å­—ç¬¦ï¼ˆåŒ…å«è¾¹ç•Œï¼‰
* `[!a-z]` â€” åŒ¹é…ä¸€ä¸ªä¸åœ¨ "a" åˆ° "z" èŒƒå›´å†…çš„å­—ç¬¦

```
db[0-9].tbl[0-9a-f][0-9a-f]
data.*
*.backup_*
```

è¿™é‡Œçš„"å­—ç¬¦"æŒ‡ Unicode ç ç‚¹ï¼Œä¾‹å¦‚ï¼š

* U+00E9 (Ã©) æ˜¯ 1 ä¸ªå­—ç¬¦ã€‚
* U+0065 U+0301 (Ã©) æ˜¯ 2 ä¸ªå­—ç¬¦ã€‚
* U+1F926 U+1F3FF U+200D U+2640 U+FE0F (ğŸ¤¦ğŸ¿â€â™€ï¸) æ˜¯ 5 ä¸ªå­—ç¬¦ã€‚

### æ–‡ä»¶å¯¼å…¥

è¦å°†æ–‡ä»¶ä½œä¸ºè¿‡æ»¤å™¨è§„åˆ™å¯¼å…¥ï¼Œåœ¨è§„åˆ™å¼€å¤´åŠ ä¸Š `@` æ¥æŒ‡å®šæ–‡ä»¶åã€‚è¡¨è¿‡æ»¤å™¨è§£æå™¨å°†å¯¼å…¥æ–‡ä»¶çš„æ¯ä¸€è¡Œä½œä¸ºé¢å¤–çš„è¿‡æ»¤å™¨è§„åˆ™ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ–‡ä»¶ `config/filter.txt` æœ‰ä»¥ä¸‹å†…å®¹ï¼š

```
employees.*
*.WorkOrder
```

ä»¥ä¸‹ä¸¤ç§è°ƒç”¨æ–¹å¼æ˜¯ç­‰æ•ˆçš„ï¼š

```bash
tiup dumpling -f '@config/filter.txt'
tiup dumpling -f 'employees.*' -f '*.WorkOrder'
```

è¿‡æ»¤å™¨æ–‡ä»¶ä¸èƒ½å†å¯¼å…¥å…¶ä»–æ–‡ä»¶ã€‚

### æ³¨é‡Šå’Œç©ºè¡Œ

åœ¨è¿‡æ»¤å™¨æ–‡ä»¶ä¸­ï¼Œæ¯è¡Œçš„å‰å¯¼å’Œå°¾éšç©ºç™½éƒ½ä¼šè¢«åˆ é™¤ã€‚æ­¤å¤–ï¼Œç©ºè¡Œï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ä¼šè¢«å¿½ç•¥ã€‚

è¡Œé¦–çš„ `#` æ ‡è®°ä¸ºæ³¨é‡Šå¹¶è¢«å¿½ç•¥ã€‚ä¸åœ¨è¡Œé¦–çš„ `#` è¢«è§†ä¸ºè¯­æ³•é”™è¯¯ã€‚

```
# è¿™è¡Œæ˜¯æ³¨é‡Š
db.table   # ä½†è¿™éƒ¨åˆ†ä¸æ˜¯æ³¨é‡Šï¼Œå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯
```

### æ’é™¤

è§„åˆ™å¼€å¤´çš„ `!` è¡¨ç¤ºå…¶åçš„æ¨¡å¼ç”¨äºæ’é™¤è¡¨ä¸è¢«å¤„ç†ã€‚è¿™å®é™…ä¸Šå°†è¿‡æ»¤å™¨è½¬å˜ä¸ºé˜»æ­¢åˆ—è¡¨ã€‚

```
*.*
#^ æ³¨æ„ï¼šå¿…é¡»å…ˆæ·»åŠ  *.* ä»¥åŒ…å«æ‰€æœ‰è¡¨
!*.Password
!employees.salaries
```

### è½¬ä¹‰å­—ç¬¦

è¦å°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸ºæ ‡è¯†ç¬¦å­—ç¬¦ï¼Œåœ¨å…¶å‰é¢åŠ ä¸Šåæ–œæ  `\`ã€‚

```
db\.with\.dots.*
```

ä¸ºäº†ç®€å•å’Œæœªæ¥çš„å…¼å®¹æ€§ï¼Œä»¥ä¸‹åºåˆ—æ˜¯ç¦æ­¢çš„ï¼š

* åœ¨åˆ é™¤ç©ºç™½åè¡Œå°¾çš„ `\`ï¼ˆä½¿ç”¨ `[ ]` æ¥åŒ¹é…è¡Œå°¾çš„å­—é¢ç©ºç™½ï¼‰ã€‚
* `\` åè·Ÿä»»ä½• ASCII å­—æ¯æ•°å­—å­—ç¬¦ï¼ˆ`[0-9a-zA-Z]`ï¼‰ã€‚ç‰¹åˆ«æ˜¯ï¼ŒC é£æ ¼çš„è½¬ä¹‰åºåˆ—å¦‚ `\0`ã€`\r`ã€`\n` å’Œ `\t` ç›®å‰æ²¡æœ‰æ„ä¹‰ã€‚

### å¼•ç”¨æ ‡è¯†ç¬¦

é™¤äº† `\`ï¼Œç‰¹æ®Šå­—ç¬¦ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ `"` æˆ– `` ` `` å¼•ç”¨æ¥æŠ‘åˆ¶ã€‚

```
"db.with.dots"."tbl\1"
`db.with.dots`.`tbl\2`
```

å¼•å·å¯ä»¥é€šè¿‡åœ¨æ ‡è¯†ç¬¦ä¸­é‡å¤è‡ªèº«æ¥åŒ…å«ã€‚

```
"foo""bar".`foo``bar`
# ç­‰æ•ˆäºï¼š
foo\"bar.foo\`bar
```

å¼•ç”¨çš„æ ‡è¯†ç¬¦ä¸èƒ½è·¨å¤šè¡Œã€‚

éƒ¨åˆ†å¼•ç”¨æ ‡è¯†ç¬¦æ˜¯æ— æ•ˆçš„ï¼š

```
"this is "invalid*.*
```

### æ­£åˆ™è¡¨è¾¾å¼

å¦‚æœéœ€è¦éå¸¸å¤æ‚çš„è§„åˆ™ï¼Œæ¯ä¸ªæ¨¡å¼å¯ä»¥å†™æˆç”¨ `/` åˆ†éš”çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š

```
/^db\d{2,}$/./^tbl\d{2,}$/
```

è¿™äº›æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ [Go æ–¹è¨€](https://pkg.go.dev/regexp/syntax?tab=doc)ã€‚å¦‚æœæ ‡è¯†ç¬¦åŒ…å«åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥æ¨¡å¼åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ`/b/` åŒ¹é… `db01`ã€‚

> **æ³¨æ„ï¼š**
>
> æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ª `/` éƒ½å¿…é¡»è½¬ä¹‰ä¸º `\/`ï¼ŒåŒ…æ‹¬åœ¨ `[â€¦]` å†…ã€‚ä½ ä¸èƒ½åœ¨ `\Qâ€¦\E` ä¹‹é—´æ”¾ç½®æœªè½¬ä¹‰çš„ `/`ã€‚

## å¤šä¸ªè§„åˆ™

<CustomContent platform="tidb-cloud">

> **æ³¨æ„ï¼š**
>
> æœ¬èŠ‚ä¸é€‚ç”¨äº TiDB Cloudã€‚ç›®å‰ï¼ŒTiDB Cloud ä»…æ”¯æŒä¸€ä¸ªè¡¨è¿‡æ»¤å™¨è§„åˆ™ã€‚

</CustomContent>

å½“è¡¨åä¸åŒ¹é…è¿‡æ»¤å™¨åˆ—è¡¨ä¸­çš„ä»»ä½•è§„åˆ™æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯å¿½ç•¥è¿™äº›æœªåŒ¹é…çš„è¡¨ã€‚

è¦æ„å»ºé˜»æ­¢åˆ—è¡¨ï¼Œå¿…é¡»å°† `*.*` ä½œä¸ºç¬¬ä¸€æ¡è§„åˆ™æ˜¾å¼ä½¿ç”¨ï¼Œå¦åˆ™æ‰€æœ‰è¡¨éƒ½å°†è¢«æ’é™¤ã€‚

```bash
# æ¯ä¸ªè¡¨éƒ½ä¼šè¢«è¿‡æ»¤æ‰
tiup dumpling -f '!*.Password'

# åªæœ‰ "Password" è¡¨è¢«è¿‡æ»¤æ‰ï¼Œå…¶ä½™çš„éƒ½åŒ…å«åœ¨å†…
tiup dumpling -f '*.*' -f '!*.Password'
```

åœ¨è¿‡æ»¤å™¨åˆ—è¡¨ä¸­ï¼Œå¦‚æœè¡¨ååŒ¹é…å¤šä¸ªæ¨¡å¼ï¼Œæœ€åä¸€ä¸ªåŒ¹é…å†³å®šç»“æœã€‚ä¾‹å¦‚ï¼š

```
# è§„åˆ™ 1
employees.*
# è§„åˆ™ 2
!*.dep*
# è§„åˆ™ 3
*.departments
```

è¿‡æ»¤ç»“æœå¦‚ä¸‹ï¼š

| è¡¨å                  | è§„åˆ™ 1 | è§„åˆ™ 2 | è§„åˆ™ 3 | ç»“æœ             |
|-----------------------|--------|--------|--------|------------------|
| irrelevant.table      |        |        |        | é»˜è®¤ï¼ˆæ‹’ç»ï¼‰     |
| employees.employees   | âœ“      |        |        | è§„åˆ™ 1ï¼ˆæ¥å—ï¼‰   |
| employees.dept_emp    | âœ“      | âœ“      |        | è§„åˆ™ 2ï¼ˆæ‹’ç»ï¼‰   |
| employees.departments | âœ“      | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰   |
| else.departments      |        | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰   |

> **æ³¨æ„ï¼š**
>
> åœ¨ TiDB å·¥å…·ä¸­ï¼Œç³»ç»Ÿ schema åœ¨é»˜è®¤é…ç½®ä¸­å§‹ç»ˆè¢«æ’é™¤ã€‚ç³»ç»Ÿ schema åŒ…æ‹¬ï¼š
>
> * `INFORMATION_SCHEMA`
> * `PERFORMANCE_SCHEMA`
> * `METRICS_SCHEMA`
> * `INSPECTION_SCHEMA`
> * `mysql`
> * `sys`
