--
title: Clinic 诊断服务简介
summary: 详细介绍 Clinic 服务
---

# Clinic 诊断服务简介
Clinic 诊断服务是 PingCAP 对 TiDB 集群提供的诊断工具和服务产品。产品旨在从全生命周期确保集群稳定运行，预测并降低问题出现概率，快速定位并修复问题。
Clinic 诊断服务包括 2 个组件：
- Diag： 部署在客户集群侧，支持诊断数据采集（collect）、本地快速健康检查（check）、诊断数据上传等功能。
- Clinic server ：部署在云端，提供 SaaS 模式的诊断服务, 接收诊断数据的上传，提供诊断数据的存储、在线查看、在线诊断以及诊断报告。 Clinic Beta 版本的 Server 端功能暂不开放给外部用户使用。

本文介绍了 Clinic 的工作原理和使用场景。

## 工作原理
本章节主要介绍 Clinic 的客户端 Diag 采集集群诊断数据的工作原理。
Diag 首先需要获取集群拓扑信息，然后通过不同的数据采集方式采集不同类型的诊断数据。 

### 获取集群拓扑信息
从部署工具（tiup-cluster/tidb-operator) 获取集群拓扑信息。

### 数据采集方式1: scp 方式传输服务器文件
对于 TiUP 部署的集群，通过 scp 方式直接从目标组件节点采集日志文件、配置文件。

### 数据采集方式2: ssh 远程执行命令采集数据
对于 TiUP 部署的集群，Diag 可以通过 ssh 到目标组件系统，执行 insight 等命令获取系统信息，包括内核日志、内核参数、基础的系统和硬件信息等。

###  数据采集方式3: http 调用采集数据
调用 TiDB 组件的 http 接口，获取 TiDB、TiKV、PD 等组件的实时配置、实时性能采样信息。调用 Prometheus 的 http 接口，获取 alert 信息和 metrics监控数据。

### 数据采集方式4: SQL 语句查询数据库参数
通过 SQL 语句，查询 TiDB 数据库的系统参数等信息，该方式需要用户在采集时额外提供访问 TiDB 数据库的用户名和密码。

## 使用场景
本章节介绍 Clinic 工具的两个主要使用场景。

### 集群问题远程定位场景

当集群出现无法快速修复的问题时，用户可以求助社区论坛或者 PingCAP 技术支持，申请远程协助都需要将问题现场的各种诊断数据进行保存，并转发给相关技术人员。 用户可以使用 Clinic 的 Diag 工具，进行一键采集，快速收集完整的诊断数据，替代复杂的手动数据采集操作。同时，用户可以将诊断数据上传到 Clinic Server 供 PingCAP 技术人员查看， Clinic Server 为诊断数据提供了安全的存储，并支持在线诊断，可以提升技术人员进行问题定位的效率。

### 本地快速诊断场景

在集群的正常运行中，需要周期检查是否有潜在的稳定性风险，Clinic 提供的本地快速诊断功能，检查潜在的健康风险。当前 Beta 版本主要提供集群配置项合理性检查，能够发现不合理的配置，并提供修改建议。