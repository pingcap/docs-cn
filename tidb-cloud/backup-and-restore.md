---
title: 备份和恢复 TiDB Cloud Dedicated 数据
summary: 了解如何备份和恢复 TiDB Cloud Dedicated 集群。
aliases: ['/tidbcloud/restore-deleted-tidb-cluster']
---

# 备份和恢复 TiDB Cloud Dedicated 数据

本文档介绍如何在 TiDB Cloud 上备份和恢复 TiDB Cloud Dedicated 集群数据。TiDB Cloud Dedicated 支持自动备份和手动备份。您还可以将备份数据恢复到新集群，或从回收站恢复已删除的集群。

> **提示**
>
> 要了解如何备份和恢复 TiDB Cloud Serverless 集群数据，请参阅[备份和恢复 TiDB Cloud Serverless 数据](/tidb-cloud/backup-and-restore-serverless.md)。

## 限制

- 对于 v6.2.0 或更高版本的集群，TiDB Cloud Dedicated 默认支持从备份中恢复用户账号和 SQL 绑定。
- TiDB Cloud Dedicated 不支持恢复存储在 `mysql` 架构中的系统变量。
- 建议您先导入数据，然后执行**手动**快照备份，最后启用时间点恢复。因为通过 TiDB Cloud 控制台导入的数据**不会**生成变更日志，无法自动检测和备份。更多信息，请参阅[从云存储将 CSV 文件导入到 TiDB Cloud Dedicated](/tidb-cloud/import-csv-files.md)。
- 如果多次开启和关闭时间点恢复，您只能选择最近一次启用时间点恢复后的可恢复范围内的时间点。早期的可恢复范围将无法访问。
- 请勿同时修改**时间点恢复**和**双区域备份**的开关。

## 备份

### 查看备份页面

1. 在项目的[**集群**](https://tidbcloud.com/project/clusters)页面上，点击目标集群的名称以进入其概览页面。

    > **提示：**
    >
    > 您可以使用左上角的组合框在组织、项目和集群之间切换。

2. 在左侧导航栏中，点击**数据** > **备份**。

### 开启自动备份

TiDB Cloud Dedicated 支持[快照备份](https://docs.pingcap.com/tidb/stable/br-snapshot-guide)和[日志备份](https://docs.pingcap.com/tidb/stable/br-pitr-guide)。快照备份使您能够将数据恢复到备份点。默认情况下，快照备份会根据您的备份保留策略自动进行并存储。您可以随时禁用自动备份。

#### 开启时间点恢复

> **注意**
>
> 时间点恢复功能支持 v6.4.0 或更高版本的 TiDB Cloud Dedicated 集群。

此功能支持将任意时间点的数据恢复到新集群。您可以使用它来：

- 降低灾难恢复的 RPO。
- 通过恢复到错误事件发生前的时间点来解决数据写入错误的情况。
- 审计业务的历史数据。

强烈建议开启此功能。成本与快照备份相同。更多信息，请参阅[数据备份成本](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)。

要为 TiDB Cloud Dedicated 集群开启此功能，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 点击**备份设置**。

3. 将**自动备份**开关切换为**开启**。

4. 将**时间点恢复**开关切换为**开启**。

    > **警告**
    >
    > 时间点恢复仅在下一次备份任务完成后生效。要使其更早生效，您可以在启用后[手动执行备份](#执行手动备份)。

5. 点击**保存**以保存更改。

#### 配置备份计划

TiDB Cloud Dedicated 支持每日和每周备份计划。默认情况下，备份计划设置为每日。您可以选择一天或一周中的特定时间开始快照备份。

要为 TiDB Cloud Dedicated 集群配置备份计划，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 点击**备份设置**。

3. 将**自动备份**开关切换为**开启**。

4. 按如下配置备份计划：

    - 在**备份周期**中，点击**每日备份**或**每周备份**选项卡。对于**每周备份**，您需要指定备份的星期几。

        > **警告**
        >
        > - 启用每周备份时，时间点恢复功能默认开启且无法禁用。
        > - 如果您将备份周期从每周更改为每日，时间点恢复功能将保持其原始设置。如果需要，您可以手动禁用它。

    - 在**备份时间**中，为每日或每周集群备份安排开始时间。

        如果您未指定首选备份时间，TiDB Cloud 会分配默认备份时间，即集群所在区域时区的凌晨 2:00。

        > **注意**
        >
        > - 当数据导入作业正在进行时，备份作业会自动延迟。在数据导入或集群扩展期间**请勿**运行手动备份。

    - 在**备份保留**中，配置最短备份数据保留期。默认期限为 7 天。为了最大限度地减少对业务的影响，建议在工作负载较低的时段安排自动备份。

        > **注意**
        >
        > - 除最新的自动备份外，所有超过保留期的自动备份都将被删除。最新的自动备份不会被删除，除非您手动删除它。这确保了在发生意外删除时，您可以恢复集群数据。
        > - 删除集群后，保留期内的自动备份将移至回收站。

### 开启双区域备份

> **注意：**
>
> - 目前，双区域备份功能仅适用于托管在 AWS 和 Google Cloud 上的集群。
> - 托管在 Google Cloud 上的 TiDB Cloud Dedicated 集群与 Google Cloud Storage 无缝协作。与 Google Cloud Storage 类似，**TiDB Cloud Dedicated 仅支持在相同的多区域代码内进行双区域配对，就像 Google 双区域存储一样**。例如，在亚洲，目前您必须将东京和大阪配对在一起以进行双区域存储。更多信息，请参阅[双区域](https://cloud.google.com/storage/docs/locations#location-dr)。

TiDB Cloud Dedicated 支持通过将备份从集群区域复制到另一个不同区域来实现双区域备份。启用此功能后，所有备份都会自动复制到指定区域。这提供了跨区域数据保护和灾难恢复能力。估计约 99% 的数据可以在一小时内复制到次要区域。

双区域备份成本包括备份存储使用费和跨区域数据传输费。更多信息，请参阅[数据备份成本](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)。

要为 TiDB Cloud Dedicated 集群开启双区域备份，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 点击**备份设置**。

3. 将**双区域备份**开关切换为**开启**。

4. 从**次要区域**下拉列表中，选择一个区域来存储备份文件。

5. 点击**保存**以保存更改。

### 关闭自动备份

> **注意**
>
> 关闭自动备份也会默认关闭时间点恢复。

要关闭 TiDB Cloud Dedicated 集群的自动备份，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 点击**备份设置**。

3. 将**自动备份**开关切换为**关闭**。

4. 点击**保存**以保存更改。

### 关闭双区域备份

> **提示**
>
> 禁用双区域备份不会立即删除次要区域中的备份。这些备份将根据备份保留计划稍后清理。要立即删除它们，您可以手动[删除备份](#删除备份)。

要关闭 TiDB Cloud Dedicated 集群的双区域备份，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 点击**备份设置**。

3. 将**双区域备份**开关切换为**关闭**。

4. 点击**保存**以保存更改。

### 执行手动备份

手动备份是用户发起的备份，使您能够根据需要将数据备份到已知状态，然后随时恢复到该状态。

> **注意**
>
> - 手动备份将无限期保留，直到您选择手动删除它们或您的账户关闭。
> - TiDB Cloud Dedicated 集群删除后，其现有的手动备份将移至回收站，并保留在那里直到手动删除或您的账户关闭。

要对 TiDB Cloud Dedicated 集群应用手动备份，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 在右上角，点击 **...** > **手动备份**。

3. 在显示的对话框中，输入**名称**。

4. 点击**确认**。然后您的集群数据将被备份。

### 删除备份

#### 删除备份文件

要删除 TiDB Cloud Dedicated 集群的现有备份文件，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 找到要删除的相应备份文件，在**操作**列中点击 **...** > **删除**。

#### 删除正在运行的备份作业

要删除 TiDB Cloud Dedicated 集群的正在运行的备份作业，请按照与[**删除备份文件**](#删除备份文件)类似的过程操作。

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 找到处于**等待中**或**运行中**状态的正在运行的备份作业，在**操作**列中点击 **...** > **删除**。

## 恢复

### 将数据恢复到新集群

> **注意**
>
> 从备份恢复 TiDB 集群时，恢复过程会保留原始时区设置而不覆盖它。

要从备份将 TiDB Cloud Dedicated 集群数据恢复到新集群，请执行以下步骤：

1. 导航到集群的[**备份**](#查看备份页面)页面。

2. 点击**恢复**。设置窗口显示。

3. 在**恢复模式**中，选择**从区域恢复**，表示备份存储的区域。

    > **注意**
    >
    > - **从区域恢复**的默认值与备份集群相同。

4. 在**恢复模式**中，选择将任意时间点的数据或选定的备份恢复到新集群。

    <SimpleTab>
    <div label="选择时间点">

    要将备份保留期内任意时间点的数据恢复到新集群，请确保**备份设置**中的**时间点恢复**已开启，然后执行以下步骤：

    - 点击**选择时间点**。
    - 选择要恢复到的**日期**和**时间**。

    </div>

    <div label="选择备份名称">

    要将选定的备份恢复到新集群，请执行以下步骤：

    - 点击**选择备份名称**。
    - 选择要恢复到的备份。

    </div>
    </SimpleTab>

5. 在**恢复到区域**中，选择与**备份设置**中配置的**主要区域**相同的区域。

6. 在**恢复**窗口中，您还可以根据需要进行以下更改：

    - 设置集群名称。
    - 更新集群的端口号。
    - 增加集群的节点数量、vCPU 和 RAM，以及存储。

7. 点击**恢复**。

   集群恢复过程开始，并显示**密码设置**对话框。

8. 在**密码设置**对话框中，设置连接集群的 root 密码，然后点击**保存**。

### 恢复已删除的集群

> **注意：**
>
> 您无法将已删除的集群恢复到任意时间点。您只能选择自动或手动备份进行恢复。

要从回收站恢复已删除的集群，请执行以下步骤：

1. 在 [TiDB Cloud 控制台](https://tidbcloud.com)中，使用左上角的组合框切换到目标项目。
2. 在左侧导航栏中，点击**项目设置** > **回收站**。
3. 在**回收站**页面上，找到要恢复的集群，在**操作**列中点击 **...**，然后点击**备份**。
4. 在**备份**页面上，找到所需的备份时间，在**操作**列中点击 **...**，然后点击**恢复**。
5. 在**恢复**页面上，为新集群指定一个名称，然后根据需要进行以下更改：

    - 更新集群的端口号。
    - 增加集群的节点数量、vCPU 和 RAM，以及存储。

6. 在**摘要**部分，检查恢复信息，然后点击**恢复**。

   集群恢复过程开始，并显示**密码设置**对话框。

7. 在**密码设置**对话框中，设置连接集群的 root 密码，然后点击**保存**。
