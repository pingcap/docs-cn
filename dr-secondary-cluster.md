---
title: TiDB 主备集群容灾
summary: 介绍在容灾场景下，如何使用 TiCDC 构建主备容灾集群
---

# TiDB 主备集群容灾

使用主、备数据库进行容灾是一种常用的容灾方式。在这种方案下，系统会有一个主集群用于处理用户的请求，并有一个备用集群负责备份主数据库的数据。当主集群发生故障时，系统可以切换到备用集群，使用备份的数据继续提供服务。这样，系统就可以在主数据库发生故障的情况下继续正常运行，避免因为故障而导致的服务中断。使用主、备数据库进行容灾具有如下优势：

- 高可用性：主、备集群的架构可以有效提高系统的可用性，使得系统在遇到故障时能够快速恢复。
- 快速切换：在主集群发生故障的情况下，系统可以快速切换到备用集群，继续提供服务。
- 数据一致性：备用集群会近实时备份主集群的数据，因此在故障发生后切换到从集群时，数据基本是最新的。

## 基于 TiCDC 的构建 TiDB 主备集群

![TiCDC secondary cluster architecture](/media/dr/dr-ticdc-secondary-cluster.png)

在上面的架构中，包含了两个 TiDB 集群：Cluster1 和 Cluster2。Cluster1 位于 Region 1 中，是一个三副本的集群，用于处理读写业务。Cluster2 位于 Region 2 中，是一个灾备集群，并通过 TiCDC 与 Cluster1 进行数据同步。这种架构简洁易用，可以容忍 Region 级别的故障，并且在写入性能上没有下降。同时，灾备集群还可以用于处理一些延迟不敏感的只读业务。RPO 在秒级别，RTO 可以做到分钟级别甚至更低。这是许多数据库厂商推荐的方案，特别是对于重要的生产系统。

### 搭建主备集群

### 从主集群复制数据到备用数据

#### 全量数据迁移

#### 实时数据变更复制

### 主备集群状态监控

## 在主备集群之间进行双向复制

## 常见问题处理

- [TiCDC 常见问题处理]

