---
title: TiUniManager 集群管理
summary: 了解如何通过 TiUniManager 对 TiDB 集群进行操作和管理。
---

# TiUniManager 集群管理

本文档介绍如何通过 TiUniManager 对 TiDB 集群进行操作和管理。

## 创建集群

TiUniManager 部署完成后，你可以通过 TiUniManager 创建 TiDB 集群，并自定义集群配置。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台
* 已完成主机资源导入

创建集群的操作步骤如下：

1. 登录控制台。
2. 进入**集群管理** > **集群**页面。
3. 点击**创建集群**按钮，跳转至创建实例的页面。
4. 选择集群创建模式。
5. 选择集群主机所在厂商、区域。
6. 输入以下数据库基本信息：
    * 数据库类型
    * CPU 体系架构
    * 数据库版本
    * 参数组
7. 设置数据库产品各组件的以下配置：
    * 所在可用区
    * 实例规格
    * 实例数量
8. 输入集群的以下基本信息：
    * 集群名称。集群名称必须是 4-64 个字符，可包含大小写字母、数字和连字符，并以字母或数字开头
    * 集群标签
    * 数据库管理员 Root 的密码。密码必须是 8-64 个字符，可包含大小写字母、数字和可见的特殊字符（包括 `!@#$%^&*()_+=）`）
    * 是否独占部署
9. 点击**提交**按钮，确认主机资源库存满足集群要求后，点击**确认创建**按钮。

## 删除集群

由于业务或其他原因，如果你不再需要某个已创建的实例，可以将某个集群删除。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 待删除的 TiDB 集群已存在。

> **注意：**
>
> 删除集群同时将删除集群上自动备份的数据。如果需要某个备份数据，应在删除实例之前将该备份恢复到新实例上。

删除集群的操作步骤如下：

1. 登录控制台。
2. 进入**集群管理** > **集群**页面。
3. 选择待删除的集群，点击集群 ID 进入**集群详情**页面。
4. 点击**删除**按钮。
5. 选择是否在删除集群前完成一次数据备份。
6. 选择是否保留手动备份数据。
7. 输入 "delete" 以确认删除，点击**确认删除**按钮。

## 扩容集群

集群运行过程中，如果由于业务或其他需求，你需要为集群添加计算引擎、存储引擎或调度引擎。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 集群已创建。

> **注意：**
>
> * 集群配置由平台配置所限定。
> * 推荐的 PD 实例数量为 1 个、3 个、5 个 或 7 个。
> * TiKV 实例数量不能低于 TiKV 副本数。

扩容的操作步骤如下：

1. 登录控制台。
2. 进入**集群管理** > **集群**页面。
3. 选择待删除的集群，点击集群 ID 进入**集群详情**页面。
4. 点击**扩容**按钮进入扩容页面。
5. 根据业务需要，选择要扩容引擎数量或新增不同规格的引擎数量。
6. 点击**提交**按钮，确认资源库存满足扩容要求后，点击**确认扩容**。

## 缩容集群

在集群运行过程中，由于业务或其他需求，你需要从集群中删除多余的计算引擎、存储引擎或调度引擎。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 集群已创建。

> **注意：**
>
> * 集群配置由平台配置所限定。
> * 当 TiDB、PD、TiKV 的实例数量最小为 1。当实例数等于 1 时，不能进行缩容操作。
> * 推荐的 PD 实例数量为 1 个、3 个、5 个 或 7 个。
> * TiKV 实例数量不能小于 TiKV 副本数。对 TiKV 进行缩容时，缩容后的 TiKV 实例数量不能小于 TiKV 副本数。

缩容集群的操作步骤如下：

1. 登录控制台。
2. 进入**集群管理** > **集群**页面。
3. 选择待删除的集群，点击集群 ID 进入**集群详情**页面。
4. 点击待删除实例所在行的**删除**按钮。
5. 点击**确认**按钮。

## 查看集群列表

查看实例的基本信息、运行情况，并使用集群删除按钮按需删除集群。

查看集群列表的操作步骤如下：

1. 登录控制台。
2. 进**集群管理** > **集群**页面即可查看集群列表，若暂无集群，则列表为空。

## 搜索集群

在集群列表页面，你根据以下指标搜索集群：

* 集群运行状态（可选择）
* 集群 ID（需要输入集群 ID，暂不支持模糊搜索）
* 集群名称（需要输入集群名称，暂不支持模糊搜索）
* 标签（需要输入标签，暂不支持模糊搜索）

搜索集群前，确保以下条件已满足：

* 已登录平台控制台。
* 集群已创建。

搜索集群的操作步骤如下：

1. 进入**集群详情**页面。
2. 选择搜索指标。
3. 点击搜索按钮，确认搜索，集群详情列表展示搜索结果。

## 查看集群详情

你可通过 TiUniManager 查看集群配置、运行情况、计算、存储、调度等各引擎列表及信息详情。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 集群已创建。

查看集群详情的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入**集群详情**页面。

## 性能分析

你可通过 TiUniManager 查看集群的 SQL 语句分析、慢 SQL 查询分析、流量可视化、集群诊断。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 集群已创建。 ß

性能分析的操作步骤如下：

1. 进入**集群管理** > **集群**页面
2. 点击集群 ID 进入**集群详情**页面，再点击**性能分析**标签页，你可看到**SQL 语句分析**、**慢查询日志**、**流量可视化**、**诊断**四个子标签页。
3. 点击语句分析页签，进入 **SQL 语句分析**标签页。了解 [SQL 语句分析](/dashboard/dashboard-statement-details.md)详情。
4. 点击慢查询分析页签，进入**慢查询分析**标签页。了解[慢查询分析](/analyze-slow-queries.md)详情。
5. 点击流量可视化页签，进入**流量可视化**标签页。了解[流量可视化](/dashboard/dashboard-key-visualizer.md)详情
6. 点击集群诊断页签，进入集群**诊断**标签页。了解[集群诊断](/dashboard/dashboard-diagnostics-access.md) 详情。

## 日志管理

在集群详情页面，你可以查看该集群各组件日志，也可以选择时间范围进行日志查询，或按照日志级别、实例 IP 地址查看日志。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 集群已创建。

日志管理的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入**集群详情**页面。
3. 点击**日志管理**页签，进入日志管理标签页，默认以时间倒序排序展示集群日志，并可按照以下维度进行日志过滤：
    * 按时间范围过滤
    * 按组件（计算、存储、调度）过滤
    * 按日志级别过滤
    * 按日志内容关键词过滤
    * 按实例 IP 地址过滤

## 集群监控

在 TiUniManager 中，你可通过集成的 Grafana 面板查看集群整体、组件、节点实例的运行情况（组件分别展示：PD、TiDB、TiKV）。

进行操作前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 集群已创建。

查看集群监控的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入集群详情页面，并点击**集群监控**页签。
3. 在**集群监控**页签中，默认显示 TiDB-Summary Dashboard。
4. 可通过选择 Dashboard 一级目录，列出所有可用 Dashboard。

## 告警管理

TiUniManager 集成了 TiDB 集群组件的报价规则，按照严重程度由高到低罗列。报警项可分为紧急级别 > 严重级别 > 警告级别三类。该分级适用于以下各组件的报警项。

TiDB 集群告警规则可参见在线文档：[TiDB 集群报警规则](/alert-rules.md)

进行告警管理前，确保以下条件已满足：

* 已登录 TiUniManager 控制台。
* 集群已创建。

告警管理的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入集群详情页面，并点击**告警管理**页签。

## 参数管理

你可通过 TiUniManager 查看集群实例的参数信息，并修改集群的参数运行值。

进行操作前，确保以下条件已满足：

* 已登录TiUniManager控制台
* 集群已创建

参数管理的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入集群详情页面，并点击**参数管理**页签。
3. 选择要修改的参数项，点击**编辑**进行修改，完成后点击**确认。**
4. 点击**保存**按钮，使参数运行值生效。

## 备份管理 - 数据备份

TiUniManager 提供自动定期备份功能。集群创建成功并开始正常运行后，你可对集群设置定期备份时间，TiUniManager 会对集群数据进行定时备份，备份的数据将保存到你所设置的存储位置中（S3 兼容存储和 NFS 共享存储）。你也可以逐条删除不需要的备份数据文件。

进行操作前，确保以下条件已满足：

* 已经登录TiUniManager控制台。
* 集群已创建。

> **注意：**
>
> * 备份保存的默认文件夹不可修改。

TiUniManager 默认的集群备份路径相关配置参数如下：

| **配置描述**                                                 | **配置参数名**          | **参考值**                                                   |
| ------------------------------------------------------------ | ----------------------- | ------------------------------------------------------------ |
| TiDB 集群备份的存储类型（仅支持 NFS 或 S3）                  | BackupStorageType       | 's3' 或 'nfs'                                                |
| TiDB 集群备份的存储路径 （S3 bucket 路径，或 NFS share 的绝对路径） | BackupStoragePath       | 'bucketPath/backup' (S3 路径示例）'/mnt/nfspath' (NFS 路径示例） |
| TiDB 集群备份在 S3 共享存储时，S3 的AccessKey                | BackupS3AccessKey       | ''                                                           |
| TiDB 集群备份在 S3 共享存储时，S3 的 SecretAccessKey         | BackupS3SecretAccessKey | ''                                                           |
| TiDB 集群备份在 S3 共享存储时,S3 的 Endpoint（域名）         | BackupS3Endpoint        | ''                                                           |

当前不支持通过 TiUniManager 界面修改备份路径。如需修改备份路径，需要通过 OpenAPI 修改配置参数，以修改配置参数 `BackupS3AccessKey` 为例：

1. 登录 TiUniManager 获取 user token。

    {{< copyable "shell-regular" >}}

    ```shell
    curl -X 'POST' \ 'http://172.16.6.206:4180/api/v1/user/login' \ -H 'accept: application/json' \ -H 'Content-Type: application/json' \ -d '{ "userName": "admin", "userPassword": "admin" }'
    ```

    > **注意：**
    >
    > 你需要将以上命令中 `172.16.6.206:4180` 替换为实际环境中 TiUniManager 中控机的 IP 地址和 WebServer 服务端口。

2. 查看配置参数值。

    {{< copyable "shell-regular" >}}

    ```shell
    curl -X GET "http://172.16.6.206:4100/api/v1/config/?configKey=BackupS3AccessKey" -H "Authorization: Bearer 6ea768e4-c0ec-4d48-b401-0f114ddc994c"
    ```

3. 修改配置参数值。

    {{< copyable "shell-regular" >}}

    ```shell
    curl -X POST "http://172.16.6.206:4100/api/v1/config/update" -d "{ \"configKey\": \"BackupS3AccessKey\", \"configValue\": \"newValue\"}" -H "Authorization: Bearer 6ea768e4-c0ec-4d48-b401-0f114ddc994c"
    ```

数据备份的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入集群详情页面，并点击**备份管理**页签。
3. 点击**备份计划**按钮，配置自动备份策略。
4. 点击**手动备份**按钮，立即开始手动备份。
5. 选择备份并点击删除按钮，确认删除选择的备份。
6. 查询某时间段的备份：
    * 默认以时间倒序排序展示备份
    * 查询某时间段的备份

## 备份管理 - 数据恢复

使用 TiUniManager 的备份数据恢复功能，将一个 TiDB 集群的备份数据恢复到一个新集群。

进行操作前，确保以下条件已满足：

* 已经登录控制台。
* 集群的备份记录已存在。

> **注意：**
>
> 备份数据恢复到新创建的集群上，不会覆盖已创建实例。

数据恢复的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入集群详情页面，并点击**备份管理**页签。
3. 选择要恢复的备份记录，点击**恢复**，跳转恢复集群页面。
4. 设置新集群的名称、标签和数据库密码。
5. 选择新集群的 Region 区域。
6. 确认新集群的实例配置规格与数量。
7. 点击**提交**按钮，确认创建新集群并随后开始自动恢复实例。

## 数据同步

通过 TiUniManager，你可以使用 TiDB 增量数据同步功能，从配置了 TiCDC 组件的上游 TiDB 集群，将增量数据同步到下游系统（TiDB 数据库、MySQL 数据库或 Kafka）。

进行操作前，确保以下条件已满足：

* 已经登录控制台。

> **注意：**
>
> 数据同步功能仅支持 TiDB v5.2.2 及其以上版本。

数据同步的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 点击集群 ID 进入集群详情页面，并点击**数据同步**页签。
3. 点击**创建**按钮创建数据同步任务。
4. 填写数据同步任务基本信息：
    * 任务名称
    * 同步任务开始 TSO 值（填入 “0” 则系统将从当前时刻获取起始 TSO）
    * 过滤规则（参见[表库过滤语法](/table-filter.md)）
5. 填写下游信息：
    * 下游类型（TiDB、MySQL、Kafka)
    * 下游 URL 或 IP 地址
    * 下游数据库服务端口
    * 下游数据库用户名
    * 下游数据库密码
    * 同步任务并发数
6. 点击**提交**按钮。

## 查看参数组

TiUniManager v1.0.0 为 TiDB v5.1.x、v5.2.x、v5.3.x、v5.4.x 提供内置的默认参数组（暂不支持 TiDB v6.0 参数组），你可查看参数组下的参数详情。

进行操作前，确保以下条件已满足：

* 已经登录控制台。

查看参数组步骤如下：

1. 进入**集群管理** > **参数组**页面，查看所有的参数组列表。
2. 点击参数组名称，查看参数组中详情：参数类别、参数名称、参数列表、默认值、参数描述。

## 编辑、复制、应用参数组

TiUniManager 为 TiDB v5.1.x、v5.2.x、v5.3.x、v5.4.x 提供内置的默认参数组，你可直接应用默认参数组到集群实例，也可复制默认参数组并根据实际运行情况对参数进行调优。

进行操作前，确保以下条件已满足：

* 已经登录控制台。

编辑、复制、应用参数组的操作步骤如下：

1. 进入**集群管理** > **参数组**页面。
2. 点击待修改的参数组对应的**编辑**操作，对参数组默认值进行修改。
3. 点击待复制的参数组对应的**复制**操作，将参数组复制产生一份新的参数组。
4. 点击参数组对应的**应用**操作，可将参数组应用到适配的集群。

## 接管集群

你可通过 TiUniManager 接管已有的 TiDB 集群。

进行操作前，确保以下条件已满足：

* 已经登录控制台。

接管集群的操作步骤如下：

1. 进入**集群管理 > 集群**页面。
2. 点击**接管集群**按钮，进入接管集群页面。
3. 输入接管集群的基本信息：集群名称、数据库用户名 root、数据库密码。
4. 输入接管集群中控配配置信息：
    * 接管集群中控机主机 IP 地址
    * 接管集群中控机 SSH 端口号
    * 接管集群中控机 SSH 用户名
    * 接管集群中控机 SSH 密码
    * 接管集群中控机 TiUP 路径（即 `.tiup` 目录所在路径，不含结尾的 `/`，例如 `/root/.tiup` ）
5. 导入接管集群的主机（导入主机流程参见[导入主机](/tiunimanager/tiunimanager-manage-host-resources.md#导入主机)）。

## 重启集群

你可在 TiUniManager 上重启指定的 TiDB 集群。

进行操作前，确保以下条件已满足：

* 已经登录控制台。

重启集群的操作步骤如下：

1. 进入**集群管理 > 集群**页面。
2. 点击待重启集群的**重启**操作。
3. 点击**确认**按钮开始重启集群。

## 停止集群

你可在 TiUniManager 上停止指定的 TiDB 集群。

进行操作前，确保以下条件已满足：

* 已经登录 TiUniManager 控制台。

停止集群的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 选择集群，点击**停止**。
3. 点击**确认**按钮，开始停止集群。

## 克隆集群

你可通过 TiUniManager 从一个 TiDB 集群克隆出一个新集群。新集群与源集群之间数量关系可配置为：

* 全量：克隆集群并与源集群建立主备关系，主集群实时向备集群同步数据
* 快照：克隆集群，但不建立主备关系

进行操作前，确保以下条件已满足：

* 已经登录 TiUniManager 控制台。
* 已有 TiDB 集群。

> **注意：**
>
> 克隆集群功能仅支持 TiDB v5.2.2 及其以上版本。

克隆集群的操作步骤如下：

1. 进入**集群管理 > 集群**页面。
2. 选择要产生克隆集群的源集群，进入集群详情页面。
3. 点击**克隆集群**按钮。
4. 选择**克隆策略。**
5. 填写新集群配置信息。
6. 点击**提交**按钮。

## 切换主备集群

你可通过 TiUniManager 选择一个备集群，并将其切换为主集群，此时集群的原主集群将自动被切换为备集群。

进行操作前，确保以下条件已满足：

* 当前 TiDB 集群为备集群。

> **注意：**
>
> 主备集群切换功能仅支持 TiDB v5.2.2 及其以上版本。

切换的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 选择备集群，进入备集群详情页面。
3. 点击备集群后的**切换。**
4. 确认备注集群切换信息后点击**确认**按钮

## 原地升级集群

你可通过 TiUniManager 将指定的 TiDB 集群升级为更高版本的集群。

进行操作前，确保以下条件已满足：

* 已经登录 TiUniManager 控制台。

原地升级集群的操作步骤如下：

1. 进入**集群管理** > **集群**页面。
2. 选择要升级的集群，进入集群详情页面。
3. 点击**数据库版本**编号后的**升级**操作，进入集群版本升级页面。
4. 选择目标版本、升级类型、升级方式，点击**下一步**按钮。
5. 查看对比和合并配置参数，选择参数值为原版本值以及新版本值，点击**下一步**按钮。
6. 确认合并后的配置参数，点击**确认**按钮。

## 巡检集群

你可通过 TiUniManager 巡检功能检查集群各个维度是否健康，包括集群资源分配是否泄露，Region 是否健康，参数配置是否正常等等。

进行操作前，确保以下条件已满足：

* 已经登录 TiUniManager 控制台

TiUniManager 于每天 23:00 自动进行集群巡检。

查看巡检结果的方法：在工作流任务管理中查看任务名为 "CheckPlatform" 的任务流，点击 **checkHosts** 步骤可以查看，如下图所示：

![集群巡检图](/media/tiunimanager/tiunimanager-checkhosts.png)
